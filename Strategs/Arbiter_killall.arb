//====================================================================
//      ST AiScript: Arbiter for Kill All game
//====================================================================
include<[_inc_path]\AiScript.dfn>;
include<[_inc_path]\AiScript.mcr>;

#if(_env_var1==0)
 _full_name = "Kill All";
#endif

OpenArbiter(_full_name, 0x00000001);
 
  // Events 
 OpenEvents();
  // Const
  s_win    = 14;
  s_defeat = 15;
  BASIC_NAME = "The thing";
  SILICON_MINE_NAME = "SM";
  BUILDER_NAME = "Builder";
  
  // Used variables :
  //   _RT100-_RT107 - mission conditions

  // Init
  Event(TRUE) 
  { // Start set
    //ActCreateStartSet(PLAYER_ALL,AIREL_MYSELF, LEVEL_DEFINED);
    _ploop_begin
      if(GetPlCiv(_pl_)==CIV_WS)     //--WS--
      { ActCreatePlObj(_plmyself, CONSTRUCTOR, -1, -1, -1, LOGO_UNDEF, BASIC_NAME); 
        if(GetStartSetLevel()>LEVEL_LOW)        
        { ActCreatePlObj(_plmyself, SENTINEL, -1, -1, -1, LOGO_UNDEF, BASIC_NAME);  
          ActCreatePlObj(_plmyself, SENTINEL, -1, -1, -1, LOGO_UNDEF, BASIC_NAME);  
          ActCreatePlObj(_plmyself, HUNTER, -1, -1, -1, LOGO_UNDEF, BASIC_NAME);  
        }
        if(GetStartSetLevel()>LEVEL_MEDIUM)  
        { ActCreatePlObj(_plmyself, CRUISER, -1, -1, -1, LOGO_UNDEF, BASIC_NAME);  
          ActCreatePlObj(_plmyself, MARAUDER, -1, -1, -1, LOGO_UNDEF, BASIC_NAME); 
        }
      }
      else
      { if(GetPlCiv(_pl_)==CIV_BO)   //--BO--
        { ActCreatePlObj(_plmyself, ASSEMBLER, -1, -1, -1, LOGO_UNDEF, BASIC_NAME); 
          if(GetStartSetLevel()>LEVEL_LOW)        
          { ActCreatePlObj(_plmyself, FIGHTER, -1, -1, -1, LOGO_UNDEF, BASIC_NAME);  
            ActCreatePlObj(_plmyself, FIGHTER, -1, -1, -1, LOGO_UNDEF, BASIC_NAME);  
            ActCreatePlObj(_plmyself, DESTROYER, -1, -1, -1, LOGO_UNDEF, BASIC_NAME); 
          }
          if(GetStartSetLevel()>LEVEL_MEDIUM)  
          { ActCreatePlObj(_plmyself, HEAVY_CRUISER, -1, -1, -1, LOGO_UNDEF, BASIC_NAME); 
            ActCreatePlObj(_plmyself, RAIDER, -1, -1, -1, LOGO_UNDEF, BASIC_NAME); 
          }
        }
        else                         //--SI--
        { ActCreatePlObj(_plmyself, CAPSULE_PROTOTYPE, -1, -1, -1, LOGO_UNDEF, BASIC_NAME); 
          ActCreatePlObj(_plmyself, CAPSULE_PROTOTYPE, -1, -1, -1, LOGO_UNDEF, BASIC_NAME); 
          ActCreatePlObj(_plmyself, CAPSULE_PROTOTYPE, -1, -1, -1, LOGO_UNDEF, BASIC_NAME); 
          if(GetRCLevel() == LEVEL_MEDIUM)
          {
            ActCreatePlObj(_plmyself, CAPSULE_PROTOTYPE, -1, -1, -1, LOGO_UNDEF, BASIC_NAME); 
            ActCreatePlObj(_plmyself, CAPSULE_PROTOTYPE, -1, -1, -1, LOGO_UNDEF, BASIC_NAME); 
          }
          if(GetRCLevel() == LEVEL_HIGH)
          {
            ActCreatePlObj(_plmyself, CAPSULE_PROTOTYPE, -1, -1, -1, LOGO_UNDEF, BASIC_NAME); 
            ActCreatePlObj(_plmyself, CAPSULE_PROTOTYPE, -1, -1, -1, LOGO_UNDEF, BASIC_NAME); 
            ActCreatePlObj(_plmyself, CAPSULE_PROTOTYPE, -1, -1, -1, LOGO_UNDEF, BASIC_NAME); 
          }
          if(GetStartSetLevel()>LEVEL_LOW)        
          { 
            ActCreatePlObj(_plmyself, SHS_SUB, -1, -1, -1, LOGO_UNDEF, BASIC_NAME); 
            ActCreatePlObj(_plmyself, SHS_SUB, -1, -1, -1, LOGO_UNDEF, BASIC_NAME); 
            ActCreatePlObj(_plmyself, SHS_SUB, -1, -1, -1, LOGO_UNDEF, BASIC_NAME); 
          }
          if(GetStartSetLevel()>LEVEL_MEDIUM)  
          { ActCreatePlObj(_plmyself, ESCORT, -1, -1, -1, LOGO_UNDEF, BASIC_NAME); 
            ActCreatePlObj(_plmyself, USURPER, -1, -1, -1, LOGO_UNDEF, BASIC_NAME); 
          }
        }
      }
    _ploop_end
    // Off
    actOffEvent(10);actOffEvent(20);actOffEvent(30); actOffEvent(100);
  }
  // On
  Event(getOwnTime()>10)
  { actOnEvent(IsTeamGame() ? 20 : 10);
    actOnEvent(30);
    actOnEvent(100);
  }

  // Player has been killed
  Event(getOwnTime()%3==1, 10)
  { _ploop_begin
     if(!getVar(100+_pl_) && GetPlObjM(_plmyself, AITRG_ALL)==0)
     { actSetVar(100+_pl_, ENDMISS_FAILED);ActOnTimer(_plmyself,10);ActOffFOW(_plmyself);                                 
       _actStringMess(_strf(GetStrRes(s_defeat), GetPlName(_pl_)));
     }
    _ploop_end
    actLockEvent();
  }
  // Player's team has been killed
  Event(getOwnTime()%3==1, 20)
  { _ploop_begin
     if(!getVar(100+_pl_) && GetPlObjM(_plunion, AITRG_ALL)==0)
     { actSetVar(100+_pl_, ENDMISS_FAILED);ActOnTimer(_plmyself,10);ActOffFOW(_plmyself);                                 
       _actStringMess(_strf(GetStrRes(s_defeat), GetPlName(_pl_)));
     }
    _ploop_end
    actLockEvent();
  }
  // Player's enemies have been killed
  Event(getOwnTime()%3==1, 30)
  { 
    _ploop_begin
     if(!getVar(100+_pl_) && GetPlObjM(_plnotally, AITRG_ALL)==0)
     {
       actSetVar(100+_pl_, ENDMISS_ACCOMPL);ActOnTimer(_plmyself,10);ActOffFOW(_plmyself);                                 
       _actStringMess(_strf(GetStrRes(s_win), GetPlName(_pl_)));
     }
    _ploop_end
    actLockEvent();
  }
  // The final phase 
  Event(TRUE, 100)
  { _ploop_begin
     if(getVar(100+_pl_)>0 && GetTimerTime(_pl_)==0)
     { ActOffTimer(_plmyself);ActTotalStatistics(_plmyself, 10);ActEndMiss(_plmyself, getVar(100+_pl_));actSetVar(100+_pl_, -1);
     }
    _ploop_end
    actLockEvent();
  }

  EventPlObjCreated(_PI3 != SILICON_EXTRACTOR && _PI3 != CAPSULE_PROTOTYPE && _PI3 == ASSEMBLER && _PI3 == CONSTRUCTOR)
  {
    ActSetName(BASIC_NAME, _PI5,_PI6,_PI7);
    ActLockEvent();
  }

  EventPlObjCreated(_PI3 == SILICON_EXTRACTOR)
  {
    ActSetName(SILICON_MINE_NAME, _PI5,_PI6,_PI7);
    ActLockEvent();
  }

  EventPlObjCreated(_PI3 == CAPSULE_PROTOTYPE || _PI3 == ASSEMBLER || _PI3 == CONSTRUCTOR)
  {
      ActSetName(BUILDER_NAME, _PI5,_PI6,_PI7);
      ActLockEvent();
  }

//  EventPlObjKilled(TRUE)
//  {
//    ActStringMess(PLAYER_ALL, AIREL_MYSELF, _PS1 + " killed " + _PS0)
//    ActLockEvent();
//  }


////////////// Debug //////////////////

EventInput(_PI0==7){ActDelPlObjEx(PLAYER_0, AIREL_MYSELF, AITRG_ALL);actLockEvent();}
EventInput(_PI0==0){ActDelPlObjEx(PLAYER_1, AIREL_MYSELF, AITRG_ALL);actLockEvent();}
EventInput(_PI0==1){ActDelPlObjEx(PLAYER_2, AIREL_MYSELF, AITRG_ALL);actLockEvent();}
EventInput(_PI0==2){ActDelPlObjEx(PLAYER_3, AIREL_MYSELF, AITRG_ALL);actLockEvent();}
EventInput(_PI0==3){ActDelPlObjEx(PLAYER_4, AIREL_MYSELF, AITRG_ALL);actLockEvent();}
EventInput(_PI0==4){ActDelPlObjEx(PLAYER_5, AIREL_MYSELF, AITRG_ALL);actLockEvent();}
EventInput(_PI0==5){ActDelPlObjEx(PLAYER_6, AIREL_MYSELF, AITRG_ALL);actLockEvent();}
EventInput(_PI0==6){ActDelPlObjEx(PLAYER_7, AIREL_MYSELF, AITRG_ALL);actLockEvent();}

/* 
enem_boats = GetPlObjM(PLAYER_CURR, AIREL_ENEMYS, AITRG_BOATALL);
enem_tlo   = GetPlObjM(PLAYER_CURR, AIREL_ENEMYS, AITRG_TLOALL);
enem_gold  = GetPlRes(PLAYER_CURR, AIREL_ENEMYS, GOLD);
enem_cor   = GetPlRes(PLAYER_CURR, AIREL_ENEMYS, CORIUM);
enem_metal = GetPlRes(PLAYER_CURR, AIREL_ENEMYS, METAL, );
*/

 CloseEvents();

CloseArbiter();
